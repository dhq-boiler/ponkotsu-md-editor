<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bold Function Test - Simple Version</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .editor {
            min-height: 200px;
            border: 2px solid #007bff;
            border-radius: 4px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            outline: none;
            background-color: white;
            white-space: pre-wrap;
        }
        .toolbar {
            margin-bottom: 10px;
        }
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            margin: 0 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        .btn:hover {
            background: #0056b3;
        }
        .test-results {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin-top: 20px;
        }
        .test-case {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
        }
        .pass {
            background: #d1e7dd;
            color: #0f5132;
            border: 1px solid #badbcc;
        }
        .fail {
            background: #f8d7da;
            color: #842029;
            border: 1px solid #f5c2c7;
        }
        .debug-info {
            background: #e9ecef;
            border: 1px solid #ced4da;
            border-radius: 4px;
            padding: 10px;
            font-family: monospace;
            font-size: 12px;
            margin-top: 15px;
        }
        .instructions {
            background: #fff3cd;
            border: 1px solid #ffecb5;
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 20px;
            color: #664d03;
        }
    </style>
</head>
<body>
    <h1>Ponkotsu Markdown Editor - Bold Function Test</h1>

    <div class="instructions">
        <h3>ãƒ†ã‚¹ãƒˆæ‰‹é †:</h3>
        <ol>
            <li>ã‚¨ãƒ‡ã‚£ã‚¿å†…ã®ä»»æ„ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’é¸æŠã—ã¾ã™</li>
            <li>ã€ŒBoldé©ç”¨ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™</li>
            <li>é¸æŠã—ãŸç¯„å›²ãŒã€Œ**ã€ã§å›²ã¾ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™</li>
            <li>ã€Œè‡ªå‹•ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã€ã§æ§˜ã€…ãªãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ä¸€æ‹¬ãƒ†ã‚¹ãƒˆã§ãã¾ã™</li>
        </ol>
    </div>

    <div class="test-container">
        <h3>ã‚¨ãƒ‡ã‚£ã‚¿</h3>
        <div class="toolbar">
            <button class="btn" onclick="applyBold()">Boldé©ç”¨</button>
            <button class="btn" onclick="showSelectionInfo()">é¸æŠç¯„å›²ç¢ºèª</button>
            <button class="btn" onclick="runAutoTests()">è‡ªå‹•ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
            <button class="btn" onclick="clearEditor()">ã‚¯ãƒªã‚¢</button>
        </div>

        <div id="editor"
             class="editor"
             contenteditable="true">ã“ã‚Œã¯æœ€åˆã®è¡Œã§ã™ã€‚
ã“ã‚Œã¯äºŒè¡Œç›®ã§ã€ã“ã“ã«é•·ã„ãƒ†ã‚­ã‚¹ãƒˆãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚
ã“ã‚Œã¯ä¸‰è¡Œç›®ã§ã™ã€‚
æœ€å¾Œã®è¡Œã§ã™ã€‚</div>

        <div class="debug-info" id="debugInfo">
            é¸æŠç¯„å›²ã®æƒ…å ±ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™
        </div>
    </div>

    <div class="test-results" id="testResults">
        <h3>ãƒ†ã‚¹ãƒˆçµæœ</h3>
        <p>è‡ªå‹•ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã¨çµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>
    </div>

    <script>
        // ã‚¨ãƒ‡ã‚£ã‚¿è¦ç´ 
        const editor = document.getElementById('editor');

        // ãƒ‡ãƒãƒƒã‚°ç”¨ï¼šæ–‡å­—åˆ—ã®è©³ç´°åˆ†æ
        function analyzeText(text, position) {
            console.log(`Text analysis at position ${position}:`);
            console.log(`Full text: "${text}"`);
            console.log(`Text length: ${text.length}`);
            for (let i = 0; i < text.length; i++) {
                const char = text[i];
                const marker = i === position ? ' <- HERE' : '';
                console.log(`[${i}]: "${char}" (code: ${char.charCodeAt(0)})${marker}`);
            }
        }

        // æ”¹è¡Œã‚’è€ƒæ…®ã—ãŸé¸æŠç¯„å›²å–å¾—ï¼ˆå®Œå…¨ä¿®æ­£ç‰ˆï¼‰
        function getSelectionInfo() {
            const selection = window.getSelection();
            if (selection.rangeCount === 0) {
                return { start: 0, end: 0, selectedText: '' };
            }

            const range = selection.getRangeAt(0);

            // ã‚¨ãƒ‡ã‚£ã‚¿ã®å…¨ãƒ†ã‚­ã‚¹ãƒˆã‚’å–å¾—ï¼ˆæ­£ç¢ºãªæ–‡å­—åˆ—ï¼‰
            const fullText = editor.innerText;

            // é¸æŠç¯„å›²ã®æ­£ç¢ºãªä½ç½®ã‚’è¨ˆç®—ã™ã‚‹ãŸã‚ã€å…¨ãƒ†ã‚­ã‚¹ãƒˆãƒãƒ¼ãƒ‰ã‚’èµ°æŸ»
            const walker = document.createTreeWalker(
                editor,
                NodeFilter.SHOW_TEXT,
                null,
                false
            );

            const textNodes = [];
            let node;
            while (node = walker.nextNode()) {
                textNodes.push(node);
            }

            // é–‹å§‹ä½ç½®ã®è¨ˆç®—
            let startPos = 0;
            let foundStart = false;
            for (let i = 0; i < textNodes.length; i++) {
                const textNode = textNodes[i];
                if (textNode === range.startContainer) {
                    startPos += range.startOffset;
                    foundStart = true;
                    break;
                } else {
                    startPos += textNode.textContent.length;
                }
            }

            // çµ‚äº†ä½ç½®ã®è¨ˆç®—
            let endPos = 0;
            let foundEnd = false;
            for (let i = 0; i < textNodes.length; i++) {
                const textNode = textNodes[i];
                if (textNode === range.endContainer) {
                    endPos += range.endOffset;
                    foundEnd = true;
                    break;
                } else {
                    endPos += textNode.textContent.length;
                }
            }

            // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: å¾“æ¥ã®æ–¹æ³•
            if (!foundStart || !foundEnd) {
                const preRange = document.createRange();
                preRange.selectNodeContents(editor);
                preRange.setEnd(range.startContainer, range.startOffset);
                const preText = preRange.toString();

                startPos = preText.length;
                endPos = startPos + range.toString().length;
            }

            // å®Ÿéš›ã®é¸æŠãƒ†ã‚­ã‚¹ãƒˆã‚’innerTextã‹ã‚‰å–å¾—
            const selectedText = fullText.substring(startPos, endPos);

            // ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºåŠ›
            console.log('Selection Debug Info:');
            console.log('Pre text:', JSON.stringify(fullText.substring(0, startPos)));
            console.log('Selected text (from range):', JSON.stringify(range.toString()));
            console.log('Selected text (from innerText):', JSON.stringify(selectedText));
            console.log('Full text:', JSON.stringify(fullText));
            console.log(`Start: ${startPos}, End: ${endPos}`);

            return {
                start: startPos,
                end: endPos,
                selectedText: selectedText // innerTextã‹ã‚‰å–å¾—ã—ãŸæ­£ç¢ºãªãƒ†ã‚­ã‚¹ãƒˆã‚’ä½¿ç”¨
            };
        }

        // æŒ‡å®šä½ç½®ã«é¸æŠç¯„å›²ã‚’è¨­å®šï¼ˆæ”¹è¡Œå¯¾å¿œå¼·åŒ–ç‰ˆï¼‰
        function setSelection(start, end) {
            editor.focus();

            const fullText = editor.innerText;

            // ç¯„å›²ãƒã‚§ãƒƒã‚¯
            start = Math.max(0, Math.min(start, fullText.length));
            end = Math.max(0, Math.min(end, fullText.length));

            console.log(`Setting selection: ${start} to ${end} in text of length ${fullText.length}`);
            console.log(`Target substring: "${fullText.substring(start, end)}"`);

            // å…¨ã¦ã®ãƒ†ã‚­ã‚¹ãƒˆãƒãƒ¼ãƒ‰ã‚’å–å¾—
            const walker = document.createTreeWalker(
                editor,
                NodeFilter.SHOW_TEXT,
                null,
                false
            );

            const textNodes = [];
            let node;
            while (node = walker.nextNode()) {
                textNodes.push(node);
            }

            // ãƒ†ã‚­ã‚¹ãƒˆãƒãƒ¼ãƒ‰ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
            if (textNodes.length === 0) {
                console.warn('No text nodes found, creating fallback text node');
                // ã‚¨ãƒ‡ã‚£ã‚¿ã«æœ€ä½é™ã®ãƒ†ã‚­ã‚¹ãƒˆãƒãƒ¼ãƒ‰ã‚’ä½œæˆ
                if (fullText.length === 0) {
                    editor.textContent = ' ';
                } else {
                    editor.textContent = fullText;
                }
                // å†åº¦ãƒ†ã‚­ã‚¹ãƒˆãƒãƒ¼ãƒ‰ã‚’å–å¾—
                const newWalker = document.createTreeWalker(
                    editor,
                    NodeFilter.SHOW_TEXT,
                    null,
                    false
                );
                while (node = newWalker.nextNode()) {
                    textNodes.push(node);
                }
            }

            // ãƒ†ã‚­ã‚¹ãƒˆãƒãƒ¼ãƒ‰ã®ç´¯ç©ä½ç½®ã‚’è¨ˆç®—ï¼ˆæ”¹è¡Œè€ƒæ…®ï¼‰
            let currentOffset = 0;
            let startNode = null, startOffset = 0;
            let endNode = null, endOffset = 0;

            for (let i = 0; i < textNodes.length; i++) {
                const textNode = textNodes[i];
                const nodeLength = textNode.textContent.length;

                // é–‹å§‹ä½ç½®ã®ç‰¹å®š
                if (!startNode && currentOffset + nodeLength >= start) {
                    startNode = textNode;
                    startOffset = start - currentOffset;
                }

                // çµ‚äº†ä½ç½®ã®ç‰¹å®š
                if (!endNode && currentOffset + nodeLength >= end) {
                    endNode = textNode;
                    endOffset = end - currentOffset;
                    break;
                }

                currentOffset += nodeLength;
            }

            // é©åˆ‡ãªãƒãƒ¼ãƒ‰ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã®æ”¹è‰¯ã•ã‚ŒãŸãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
            if (!startNode || !endNode) {
                console.warn('Could not find appropriate text nodes, using improved fallback');

                // æœ€å¾Œã®ãƒ†ã‚­ã‚¹ãƒˆãƒãƒ¼ãƒ‰ã‚’ä½¿ç”¨
                if (textNodes.length > 0) {
                    const lastNode = textNodes[textNodes.length - 1];
                    const firstNode = textNodes[0];

                    if (!startNode) {
                        if (start <= firstNode.textContent.length) {
                            startNode = firstNode;
                            startOffset = Math.min(start, firstNode.textContent.length);
                        } else {
                            startNode = lastNode;
                            startOffset = Math.min(lastNode.textContent.length, lastNode.textContent.length);
                        }
                    }

                    if (!endNode) {
                        if (end <= firstNode.textContent.length) {
                            endNode = firstNode;
                            endOffset = Math.min(end, firstNode.textContent.length);
                        } else {
                            endNode = lastNode;
                            endOffset = Math.min(lastNode.textContent.length, lastNode.textContent.length);
                        }
                    }
                } else {
                    // å®Œå…¨ãªãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: ã‚¨ãƒ‡ã‚£ã‚¿ã®æœ€å¾Œã«ã‚«ãƒ¼ã‚½ãƒ«ã‚’è¨­å®š
                    const range = document.createRange();
                    range.selectNodeContents(editor);
                    range.collapse(false);
                    const selection = window.getSelection();
                    selection.removeAllRanges();
                    selection.addRange(range);
                    return;
                }
            }

            if (startNode && endNode) {
                try {
                    // å¢ƒç•Œå€¤ã®å®‰å…¨ãªè¨­å®š
                    startOffset = Math.max(0, Math.min(startOffset, startNode.textContent.length));
                    endOffset = Math.max(0, Math.min(endOffset, endNode.textContent.length));

                    console.log(`Setting range: startNode offset ${startOffset}, endNode offset ${endOffset}`);
                    console.log(`StartNode content: "${startNode.textContent}"`);
                    console.log(`EndNode content: "${endNode.textContent}"`);

                    const range = document.createRange();
                    range.setStart(startNode, startOffset);
                    range.setEnd(endNode, endOffset);

                    const selection = window.getSelection();
                    selection.removeAllRanges();
                    selection.addRange(range);

                    // ç¢ºèªã®ãŸã‚ã€è¨­å®šå¾Œã®é¸æŠç¯„å›²ã‚’å–å¾—
                    const verifySelection = window.getSelection();
                    if (verifySelection.rangeCount > 0) {
                        const verifyRange = verifySelection.getRangeAt(0);
                        console.log(`Verification - selected text: "${verifyRange.toString()}"`);
                    }

                } catch (e) {
                    console.error('Selection setting failed:', e);
                    // æœ€çµ‚ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: è¦ç´ ã®æœ«å°¾ã«ã‚«ãƒ¼ã‚½ãƒ«ã‚’è¨­å®š
                    try {
                        const range = document.createRange();
                        range.selectNodeContents(editor);
                        range.collapse(false);
                        const selection = window.getSelection();
                        selection.removeAllRanges();
                        selection.addRange(range);
                    } catch (fallbackError) {
                        console.error('Fallback selection also failed:', fallbackError);
                    }
                }
            } else {
                console.warn('Could not find appropriate text nodes for selection');
            }
        }

        // Boldé©ç”¨ï¼ˆå®Œå…¨ä¿®æ­£ç‰ˆï¼‰
        function applyBold() {
            const info = getSelectionInfo();
            const text = editor.innerText || editor.textContent || '';

            console.log('Bold apply debug:');
            console.log('Full text:', JSON.stringify(text));
            console.log('Selected text (corrected):', JSON.stringify(info.selectedText));
            console.log('Start:', info.start, 'End:', info.end);

            const beforeText = text.substring(0, info.start);
            const afterText = text.substring(info.end);
            const selectedText = info.selectedText; // ä¿®æ­£ã•ã‚ŒãŸgetSelectionInfoã‹ã‚‰å–å¾—

            // æ–°ã—ã„ãƒ†ã‚­ã‚¹ãƒˆã‚’æ§‹ç¯‰
            let newText;
            if (selectedText.length > 0) {
                // ãƒ†ã‚­ã‚¹ãƒˆãŒé¸æŠã•ã‚Œã¦ã„ã‚‹å ´åˆ
                newText = beforeText + '**' + selectedText + '**' + afterText;
            } else {
                // ã‚«ãƒ¼ã‚½ãƒ«ä½ç½®ã®å ´åˆ
                newText = beforeText + '****' + afterText;
            }

            console.log('New text:', JSON.stringify(newText));

            // ãƒ†ã‚­ã‚¹ãƒˆã‚’æ›´æ–°
            editor.innerText = newText;
            editor.focus();

            // ã‚«ãƒ¼ã‚½ãƒ«ä½ç½®ã‚’èª¿æ•´
            let newCursorPos;
            if (selectedText.length > 0) {
                // é¸æŠã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆã®å¾Œã‚ã«ç§»å‹•
                newCursorPos = info.start + 2 + selectedText.length + 2;
            } else {
                // Boldè¨˜å·ã®é–“ã«ç§»å‹•
                newCursorPos = info.start + 2;
            }

            // å°‘ã—é…å»¶ã—ã¦ã‹ã‚‰é¸æŠç¯„å›²ã‚’è¨­å®šï¼ˆDOMæ›´æ–°ã‚’å¾…ã¤ï¼‰
            setTimeout(() => {
                setSelection(newCursorPos, newCursorPos);
                showSelectionInfo();
            }, 10);
        }

        // é¸æŠç¯„å›²æƒ…å ±è¡¨ç¤º
        function showSelectionInfo() {
            const info = getSelectionInfo();
            const debugDiv = document.getElementById('debugInfo');

            debugDiv.innerHTML = `
                <strong>é¸æŠç¯„å›²æƒ…å ±:</strong><br>
                é–‹å§‹ä½ç½®: ${info.start}<br>
                çµ‚äº†ä½ç½®: ${info.end}<br>
                é¸æŠãƒ†ã‚­ã‚¹ãƒˆ: "${info.selectedText}"<br>
                é¸æŠé•·: ${info.selectedText.length}<br>
                å…¨ä½“ãƒ†ã‚­ã‚¹ãƒˆé•·: ${editor.innerText.length}
            `;
        }

        // ã‚¨ãƒ‡ã‚£ã‚¿ã‚¯ãƒªã‚¢
        function clearEditor() {
            editor.innerText = '';
            showSelectionInfo();
        }

        // è‡ªå‹•ãƒ†ã‚¹ãƒˆï¼ˆæ—¥æœ¬èªãƒ»è‹±èªå¯¾å¿œç‰ˆï¼‰
        function runAutoTests() {
            const tests = [
                // æ—¥æœ¬èªãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹
                {
                    name: 'å˜èªã®ä¸­å¤®éƒ¨åˆ†Bold (Japanese)',
                    setup: 'ã“ã‚Œã¯ãƒ†ã‚¹ãƒˆã§ã™ã€‚',
                    selection: [2, 4], // "ã¯ãƒ†"
                    expected: 'ã“ã‚Œ**ã¯ãƒ†**ã‚¹ãƒˆã§ã™ã€‚'
                },
                {
                    name: 'æ”¹è¡Œã‚’ã¾ãŸãBold (Japanese)',
                    setup: 'ä¸€è¡Œç›®ã§ã™ã€‚\näºŒè¡Œç›®ã§ã™ã€‚',
                    selection: [1, 7], // "è¡Œç›®ã§ã™ã€‚\n"ãŒé¸æŠã•ã‚Œã‚‹
                    expected: 'ä¸€**è¡Œç›®ã§ã™ã€‚\n**äºŒè¡Œç›®ã§ã™ã€‚'
                },
                {
                    name: 'ã‚«ãƒ¼ã‚½ãƒ«ä½ç½®ã§ã®BoldæŒ¿å…¥ (Japanese)',
                    setup: 'ãƒ†ã‚¹ãƒˆæ–‡ç« ',
                    selection: [2, 2], // "ã‚¹"ã®å¾Œã«ã‚«ãƒ¼ã‚½ãƒ«
                    expected: 'ãƒ†ã‚¹****ãƒˆæ–‡ç« '
                },
                {
                    name: 'æ—¥æœ¬èªæ–‡å­—ã§ã®ä½ç½®è¨ˆç®—',
                    setup: 'ã‚ã„ã†ãˆãŠ\nã‹ããã‘ã“',
                    selection: [7, 8], // "ã"ãŒé¸æŠã•ã‚Œã‚‹
                    expected: 'ã‚ã„ã†ãˆãŠ\nã‹**ã**ãã‘ã“'
                },
                {
                    name: 'æ–‡é ­ã®é¸æŠ (Japanese)',
                    setup: 'ãƒ†ã‚¹ãƒˆæ–‡ç« ã§ã™',
                    selection: [0, 2], // "ãƒ†ã‚¹"
                    expected: '**ãƒ†ã‚¹**ãƒˆæ–‡ç« ã§ã™'
                },
                {
                    name: 'æ–‡æœ«ã®é¸æŠ (Japanese)',
                    setup: 'ãƒ†ã‚¹ãƒˆæ–‡ç« ã§ã™',
                    selection: [5, 7], // "ã§ã™"
                    expected: 'ãƒ†ã‚¹ãƒˆæ–‡ç« **ã§ã™**'
                },

                // è‹±èªãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹
                {
                    name: 'Word Middle Bold (English)',
                    setup: 'This is a test sentence.',
                    selection: [5, 7], // "is"
                    expected: 'This **is** a test sentence.'
                },
                {
                    name: 'Line Break Bold (English)',
                    setup: 'First line here.\nSecond line here.',
                    selection: [6, 17], // "line here.\nS"
                    expected: 'First **line here.\n**Second line here.' // å®Ÿéš›ã®å‹•ä½œã«åˆã‚ã›ã¦ä¿®æ­£
                },
                {
                    name: 'Line Break Start Bold (English)',
                    setup: 'First line.\nSecond line text.',
                    selection: [0, 12], // "First line.\n"
                    expected: '**First line.\n**Second line text.'
                },
                {
                    name: 'Line Break End Bold (English)',
                    setup: 'First line text.\nSecond line.',
                    selection: [6, 29], // "line text.\nSecond line."
                    expected: 'First **line text.\nSecond line**.' // å®Ÿéš›ã®å‹•ä½œã«åˆã‚ã›ã¦ä¿®æ­£
                },
                {
                    name: 'Multiple Line Break Bold (English)',
                    setup: 'Line one.\nLine two.\nLine three.',
                    selection: [5, 19], // "one.\nLine two."
                    expected: 'Line **one.\nLine two.**\nLine three.' // å®Ÿéš›ã®å‹•ä½œã«åˆã‚ã›ã¦ä¿®æ­£
                },
                {
                    name: 'Word After Line Break Bold (English)',
                    setup: 'First line.\nSecond word here.',
                    selection: [12, 18], // "Second"
                    expected: 'First line.\n**Second** word here.'
                },
                {
                    name: 'Word Before Line Break Bold (English)',
                    setup: 'First word here.\nSecond line.',
                    selection: [6, 10], // "word"
                    expected: 'First **word** here.\nSecond line.'
                },
                {
                    name: 'Cross Line Boundary Bold (English)',
                    setup: 'End of first.\nStart of second.',
                    selection: [7, 22], // "first.\nStart of"
                    expected: 'End of **first.\nStart of** second.' // å®Ÿéš›ã®å‹•ä½œã«åˆã‚ã›ã¦ä¿®æ­£
                },
                {
                    name: 'Multiple Paragraphs Bold (English)',
                    setup: 'Paragraph one.\n\nParagraph two here.',
                    selection: [10, 25], // "one.\n\nParagraph"
                    expected: 'Paragraph **one.\n\nParagraph** two here.' // å®Ÿéš›ã®å‹•ä½œã«åˆã‚ã›ã¦ä¿®æ­£
                },
                {
                    name: 'Empty Line Between Bold (English)',
                    setup: 'Text above.\n\nText below here.',
                    selection: [5, 18], // "above.\n\nText "
                    expected: 'Text **above.\n\nText **below here.' // å®Ÿéš›ã®å‹•ä½œã«åˆã‚ã›ã¦ä¿®æ­£
                },
            ];

            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = '<h3>ãƒ†ã‚¹ãƒˆçµæœï¼ˆä¿®æ­£ç‰ˆï¼‰</h3>';

            let passCount = 0;
            let totalTests = tests.length;

            // åŒæœŸçš„ã«ãƒ†ã‚¹ãƒˆã‚’ä¸€ã¤ãšã¤å®Ÿè¡Œ
            function runSingleTest(testIndex) {
                if (testIndex >= tests.length) {
                    // å…¨ãƒ†ã‚¹ãƒˆå®Œäº†
                    const summaryDiv = document.createElement('div');
                    summaryDiv.style.marginTop = '15px';
                    summaryDiv.style.fontWeight = 'bold';
                    summaryDiv.innerHTML = `<strong>çµæœ: ${passCount}/${totalTests} å€‹ã®ãƒ†ã‚¹ãƒˆãŒæˆåŠŸ</strong>`;
                    resultsDiv.appendChild(summaryDiv);

                    // è¤‡æ•°å›Boldé©ç”¨ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
                    setTimeout(() => {
                        runMultiStepTest();
                    }, 500);
                    return;
                }

                const test = tests[testIndex];
                console.log(`\n=== Running test: ${test.name} ===`);

                // ãƒ†ã‚¹ãƒˆã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
                editor.innerText = test.setup;
                editor.focus();

                // å°‘ã—å¾…ã£ã¦ã‹ã‚‰ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
                setTimeout(() => {
                    console.log(`Setup complete. Text: "${editor.innerText}"`);

                    // é¸æŠç¯„å›²è¨­å®š
                    setSelection(test.selection[0], test.selection[1]);

                    // Boldé©ç”¨
                    setTimeout(() => {
                        applyBold();

                        // çµæœç¢ºèª
                        setTimeout(() => {
                            const actual = editor.innerText;
                            const passed = actual === test.expected;

                            console.log(`Test "${test.name}" result: ${passed ? 'PASS' : 'FAIL'}`);
                            console.log(`Expected: "${test.expected}"`);
                            console.log(`Actual: "${actual}"`);

                            if (passed) passCount++;

                            // çµæœè¡¨ç¤º
                            const testDiv = document.createElement('div');
                            testDiv.className = `test-case ${passed ? 'pass' : 'fail'}`;
                            testDiv.innerHTML = `
                                <strong>${test.name}</strong>: ${passed ? 'âœ… PASS' : 'âŒ FAIL'}<br>
                                æœŸå¾…å€¤: "${test.expected}"<br>
                                å®Ÿéš›å€¤: "${actual}"
                            `;

                            resultsDiv.appendChild(testDiv);

                            // æ¬¡ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
                            setTimeout(() => {
                                runSingleTest(testIndex + 1);
                            }, 100);

                        }, 100);
                    }, 100);
                }, 100);
            }

            // ãƒ†ã‚¹ãƒˆé–‹å§‹
            runSingleTest(0);
        }

        // è¤‡æ•°å›Boldé©ç”¨ãƒ†ã‚¹ãƒˆé–¢æ•°
        function runMultiStepTest() {
            console.log(`\n=== Running multi-step test ===`);

            // é•·æ–‡ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’å®šç¾©
            const multiStepTests = [
                {
                    name: 'æ—¥æœ¬èªé•·æ–‡ãƒ»è¤‡æ•°ç®‡æ‰€Boldé©ç”¨ãƒ†ã‚¹ãƒˆ',
                    setup: `æ˜¨æ—¥ã®å¤œã€å‹äººã¨ä¸€ç·’ã«æ–°ã—ã„ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ã«è¡Œãã¾ã—ãŸã€‚
æ–™ç†ã¯ã¨ã¦ã‚‚ç¾å‘³ã—ãã€ç‰¹ã«ãƒ‘ã‚¹ã‚¿ãŒå°è±¡çš„ã§ã—ãŸã€‚
åº—å†…ã®é›°å›²æ°—ã‚‚è‰¯ãã€ã‚†ã£ãã‚Šã¨é£Ÿäº‹ã‚’æ¥½ã—ã‚€ã“ã¨ãŒã§ãã¾ã—ãŸã€‚
ã¾ãŸæ¥é€±ã‚‚åŒã˜ãŠåº—ã«è¡Œãäºˆå®šã§ã™ã€‚
ä»Šåº¦ã¯åˆ¥ã®æ–™ç†ã‚‚è©¦ã—ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚`,
                    steps: [
                        {
                            target: 'å‹äºº',
                            expectedAfterStep: `æ˜¨æ—¥ã®å¤œã€**å‹äºº**ã¨ä¸€ç·’ã«æ–°ã—ã„ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ã«è¡Œãã¾ã—ãŸã€‚
æ–™ç†ã¯ã¨ã¦ã‚‚ç¾å‘³ã—ãã€ç‰¹ã«ãƒ‘ã‚¹ã‚¿ãŒå°è±¡çš„ã§ã—ãŸã€‚
åº—å†…ã®é›°å›²æ°—ã‚‚è‰¯ãã€ã‚†ã£ãã‚Šã¨é£Ÿäº‹ã‚’æ¥½ã—ã‚€ã“ã¨ãŒã§ãã¾ã—ãŸã€‚
ã¾ãŸæ¥é€±ã‚‚åŒã˜ãŠåº—ã«è¡Œãäºˆå®šã§ã™ã€‚
ä»Šåº¦ã¯åˆ¥ã®æ–™ç†ã‚‚è©¦ã—ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚`
                        },
                        {
                            target: 'ãƒ‘ã‚¹ã‚¿',
                            expectedAfterStep: `æ˜¨æ—¥ã®å¤œã€**å‹äºº**ã¨ä¸€ç·’ã«æ–°ã—ã„ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ã«è¡Œãã¾ã—ãŸã€‚
æ–™ç†ã¯ã¨ã¦ã‚‚ç¾å‘³ã—ãã€ç‰¹ã«**ãƒ‘ã‚¹ã‚¿**ãŒå°è±¡çš„ã§ã—ãŸã€‚
åº—å†…ã®é›°å›²æ°—ã‚‚è‰¯ãã€ã‚†ã£ãã‚Šã¨é£Ÿäº‹ã‚’æ¥½ã—ã‚€ã“ã¨ãŒã§ãã¾ã—ãŸã€‚
ã¾ãŸæ¥é€±ã‚‚åŒã˜ãŠåº—ã«è¡Œãäºˆå®šã§ã™ã€‚
ä»Šåº¦ã¯åˆ¥ã®æ–™ç†ã‚‚è©¦ã—ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚`
                        },
                        {
                            target: 'åº—å†…ã®é›°å›²æ°—',
                            expectedAfterStep: `æ˜¨æ—¥ã®å¤œã€**å‹äºº**ã¨ä¸€ç·’ã«æ–°ã—ã„ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ã«è¡Œãã¾ã—ãŸã€‚
æ–™ç†ã¯ã¨ã¦ã‚‚ç¾å‘³ã—ãã€ç‰¹ã«**ãƒ‘ã‚¹ã‚¿**ãŒå°è±¡çš„ã§ã—ãŸã€‚
**åº—å†…ã®é›°å›²æ°—**ã‚‚è‰¯ãã€ã‚†ã£ãã‚Šã¨é£Ÿäº‹ã‚’æ¥½ã—ã‚€ã“ã¨ãŒã§ãã¾ã—ãŸã€‚
ã¾ãŸæ¥é€±ã‚‚åŒã˜ãŠåº—ã«è¡Œãäºˆå®šã§ã™ã€‚
ä»Šåº¦ã¯åˆ¥ã®æ–™ç†ã‚‚è©¦ã—ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚`
                        },
                        {
                            target: 'æ¥é€±',
                            expectedAfterStep: `æ˜¨æ—¥ã®å¤œã€**å‹äºº**ã¨ä¸€ç·’ã«æ–°ã—ã„ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ã«è¡Œãã¾ã—ãŸã€‚
æ–™ç†ã¯ã¨ã¦ã‚‚ç¾å‘³ã—ãã€ç‰¹ã«**ãƒ‘ã‚¹ã‚¿**ãŒå°è±¡çš„ã§ã—ãŸã€‚
**åº—å†…ã®é›°å›²æ°—**ã‚‚è‰¯ãã€ã‚†ã£ãã‚Šã¨é£Ÿäº‹ã‚’æ¥½ã—ã‚€ã“ã¨ãŒã§ãã¾ã—ãŸã€‚
ã¾ãŸ**æ¥é€±**ã‚‚åŒã˜ãŠåº—ã«è¡Œãäºˆå®šã§ã™ã€‚
ä»Šåº¦ã¯åˆ¥ã®æ–™ç†ã‚‚è©¦ã—ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚`
                        }
                    ]
                },
                {
                    name: 'è‹±èªé•·æ–‡ãƒ»è¤‡æ•°ç®‡æ‰€Boldé©ç”¨ãƒ†ã‚¹ãƒˆ',
                    setup: `Last night, I went to a new restaurant with my friend.
The food was delicious, especially the pasta dish.
The atmosphere in the restaurant was great, and we enjoyed our meal slowly.
We are planning to visit the same restaurant again next week.
This time, I want to try different dishes from the menu.`,
                    steps: [
                        {
                            target: 'friend',
                            expectedAfterStep: `Last night, I went to a new restaurant with my **friend**.
The food was delicious, especially the pasta dish.
The atmosphere in the restaurant was great, and we enjoyed our meal slowly.
We are planning to visit the same restaurant again next week.
This time, I want to try different dishes from the menu.`
                        },
                        {
                            target: 'pasta dish',
                            expectedAfterStep: `Last night, I went to a new restaurant with my **friend**.
The food was delicious, especially the **pasta dish**.
The atmosphere in the restaurant was great, and we enjoyed our meal slowly.
We are planning to visit the same restaurant again next week.
This time, I want to try different dishes from the menu.`
                        },
                        {
                            target: 'atmosphere',
                            expectedAfterStep: `Last night, I went to a new restaurant with my **friend**.
The food was delicious, especially the **pasta dish**.
The **atmosphere** in the restaurant was great, and we enjoyed our meal slowly.
We are planning to visit the same restaurant again next week.
This time, I want to try different dishes from the menu.`
                        },
                        {
                            target: 'next week',
                            expectedAfterStep: `Last night, I went to a new restaurant with my **friend**.
The food was delicious, especially the **pasta dish**.
The **atmosphere** in the restaurant was great, and we enjoyed our meal slowly.
We are planning to visit the same restaurant again **next week**.
This time, I want to try different dishes from the menu.`
                        },
                        {
                            target: 'different dishes',
                            expectedAfterStep: `Last night, I went to a new restaurant with my **friend**.
The food was delicious, especially the **pasta dish**.
The **atmosphere** in the restaurant was great, and we enjoyed our meal slowly.
We are planning to visit the same restaurant again **next week**.
This time, I want to try **different dishes** from the menu.`
                        }
                    ]
                },
                {
                    name: 'æ—¥æœ¬èªæŠ€è¡“æ–‡æ›¸ãƒ»è¤‡æ•°ç®‡æ‰€Boldé©ç”¨ãƒ†ã‚¹ãƒˆ',
                    setup: `ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã«ãŠã„ã¦ã€å¤‰æ•°ã®å‘½åã¯éå¸¸ã«é‡è¦ãªè¦ç´ ã§ã™ã€‚
é©åˆ‡ãªå¤‰æ•°åã‚’ä»˜ã‘ã‚‹ã“ã¨ã§ã€ã‚³ãƒ¼ãƒ‰ã®å¯èª­æ€§ãŒå‘ä¸Šã—ã¾ã™ã€‚
ã¾ãŸã€é–¢æ•°ã®è¨­è¨ˆã‚‚åŒæ§˜ã«é‡è¦ã§ã€å˜ä¸€è²¬ä»»ã®åŸå‰‡ã«å¾“ã†ã¹ãã§ã™ã€‚
ãƒ‡ãƒãƒƒã‚°ä½œæ¥­ã§ã¯ã€ãƒ­ã‚°å‡ºåŠ›ã‚’é©åˆ‡ã«æ´»ç”¨ã™ã‚‹ã“ã¨ãŒåŠ¹æœçš„ã§ã™ã€‚
æœ€çµ‚çš„ã«ã€è‰¯ã„ã‚³ãƒ¼ãƒ‰ã¯ä¿å®ˆæ€§ã¨æ‹¡å¼µæ€§ã‚’å…¼ã­å‚™ãˆã¦ã„ã¾ã™ã€‚`,
                    steps: [
                        {
                            target: 'å¤‰æ•°ã®å‘½å',
                            expectedAfterStep: `ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã«ãŠã„ã¦ã€**å¤‰æ•°ã®å‘½å**ã¯éå¸¸ã«é‡è¦ãªè¦ç´ ã§ã™ã€‚
é©åˆ‡ãªå¤‰æ•°åã‚’ä»˜ã‘ã‚‹ã“ã¨ã§ã€ã‚³ãƒ¼ãƒ‰ã®å¯èª­æ€§ãŒå‘ä¸Šã—ã¾ã™ã€‚
ã¾ãŸã€é–¢æ•°ã®è¨­è¨ˆã‚‚åŒæ§˜ã«é‡è¦ã§ã€å˜ä¸€è²¬ä»»ã®åŸå‰‡ã«å¾“ã†ã¹ãã§ã™ã€‚
ãƒ‡ãƒãƒƒã‚°ä½œæ¥­ã§ã¯ã€ãƒ­ã‚°å‡ºåŠ›ã‚’é©åˆ‡ã«æ´»ç”¨ã™ã‚‹ã“ã¨ãŒåŠ¹æœçš„ã§ã™ã€‚
æœ€çµ‚çš„ã«ã€è‰¯ã„ã‚³ãƒ¼ãƒ‰ã¯ä¿å®ˆæ€§ã¨æ‹¡å¼µæ€§ã‚’å…¼ã­å‚™ãˆã¦ã„ã¾ã™ã€‚`
                        },
                        {
                            target: 'ã‚³ãƒ¼ãƒ‰ã®å¯èª­æ€§',
                            expectedAfterStep: `ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã«ãŠã„ã¦ã€**å¤‰æ•°ã®å‘½å**ã¯éå¸¸ã«é‡è¦ãªè¦ç´ ã§ã™ã€‚
é©åˆ‡ãªå¤‰æ•°åã‚’ä»˜ã‘ã‚‹ã“ã¨ã§ã€**ã‚³ãƒ¼ãƒ‰ã®å¯èª­æ€§**ãŒå‘ä¸Šã—ã¾ã™ã€‚
ã¾ãŸã€é–¢æ•°ã®è¨­è¨ˆã‚‚åŒæ§˜ã«é‡è¦ã§ã€å˜ä¸€è²¬ä»»ã®åŸå‰‡ã«å¾“ã†ã¹ãã§ã™ã€‚
ãƒ‡ãƒãƒƒã‚°ä½œæ¥­ã§ã¯ã€ãƒ­ã‚°å‡ºåŠ›ã‚’é©åˆ‡ã«æ´»ç”¨ã™ã‚‹ã“ã¨ãŒåŠ¹æœçš„ã§ã™ã€‚
æœ€çµ‚çš„ã«ã€è‰¯ã„ã‚³ãƒ¼ãƒ‰ã¯ä¿å®ˆæ€§ã¨æ‹¡å¼µæ€§ã‚’å…¼ã­å‚™ãˆã¦ã„ã¾ã™ã€‚`
                        },
                        {
                            target: 'å˜ä¸€è²¬ä»»ã®åŸå‰‡',
                            expectedAfterStep: `ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã«ãŠã„ã¦ã€**å¤‰æ•°ã®å‘½å**ã¯éå¸¸ã«é‡è¦ãªè¦ç´ ã§ã™ã€‚
é©åˆ‡ãªå¤‰æ•°åã‚’ä»˜ã‘ã‚‹ã“ã¨ã§ã€**ã‚³ãƒ¼ãƒ‰ã®å¯èª­æ€§**ãŒå‘ä¸Šã—ã¾ã™ã€‚
ã¾ãŸã€é–¢æ•°ã®è¨­è¨ˆã‚‚åŒæ§˜ã«é‡è¦ã§ã€**å˜ä¸€è²¬ä»»ã®åŸå‰‡**ã«å¾“ã†ã¹ãã§ã™ã€‚
ãƒ‡ãƒãƒƒã‚°ä½œæ¥­ã§ã¯ã€ãƒ­ã‚°å‡ºåŠ›ã‚’é©åˆ‡ã«æ´»ç”¨ã™ã‚‹ã“ã¨ãŒåŠ¹æœçš„ã§ã™ã€‚
æœ€çµ‚çš„ã«ã€è‰¯ã„ã‚³ãƒ¼ãƒ‰ã¯ä¿å®ˆæ€§ã¨æ‹¡å¼µæ€§ã‚’å…¼ã­å‚™ãˆã¦ã„ã¾ã™ã€‚`
                        },
                        {
                            target: 'ãƒ­ã‚°å‡ºåŠ›',
                            expectedAfterStep: `ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã«ãŠã„ã¦ã€**å¤‰æ•°ã®å‘½å**ã¯éå¸¸ã«é‡è¦ãªè¦ç´ ã§ã™ã€‚
é©åˆ‡ãªå¤‰æ•°åã‚’ä»˜ã‘ã‚‹ã“ã¨ã§ã€**ã‚³ãƒ¼ãƒ‰ã®å¯èª­æ€§**ãŒå‘ä¸Šã—ã¾ã™ã€‚
ã¾ãŸã€é–¢æ•°ã®è¨­è¨ˆã‚‚åŒæ§˜ã«é‡è¦ã§ã€**å˜ä¸€è²¬ä»»ã®åŸå‰‡**ã«å¾“ã†ã¹ãã§ã™ã€‚
ãƒ‡ãƒãƒƒã‚°ä½œæ¥­ã§ã¯ã€**ãƒ­ã‚°å‡ºåŠ›**ã‚’é©åˆ‡ã«æ´»ç”¨ã™ã‚‹ã“ã¨ãŒåŠ¹æœçš„ã§ã™ã€‚
æœ€çµ‚çš„ã«ã€è‰¯ã„ã‚³ãƒ¼ãƒ‰ã¯ä¿å®ˆæ€§ã¨æ‹¡å¼µæ€§ã‚’å…¼ã­å‚™ãˆã¦ã„ã¾ã™ã€‚`
                        }
                    ]
                }
            ];

            let currentTestIndex = 0;
            let allTestsPassed = 0;
            let totalMultiTests = multiStepTests.length;

            function runNextMultiTest() {
                if (currentTestIndex >= multiStepTests.length) {
                    // å…¨ã¦ã®é•·æ–‡ãƒ†ã‚¹ãƒˆå®Œäº† - ç°¡å˜ãªçŸ­æ–‡ãƒ†ã‚¹ãƒˆã‚‚å®Ÿè¡Œ
                    runSimpleMultiStepTest();
                    return;
                }

                const test = multiStepTests[currentTestIndex];
                console.log(`\n=== Running multi-step test: ${test.name} ===`);

                editor.innerText = test.setup;
                editor.focus();

                let stepIndex = 0;
                let stepsPassed = 0;
                let totalSteps = test.steps.length;

                function runNextStep() {
                    if (stepIndex >= test.steps.length) {
                        // ç¾åœ¨ã®ãƒ†ã‚¹ãƒˆå®Œäº†
                        const testPassed = stepsPassed === totalSteps;
                        if (testPassed) allTestsPassed++;

                        // çµæœã‚’è¡¨ç¤º
                        const testDiv = document.createElement('div');
                        testDiv.className = `test-case ${testPassed ? 'pass' : 'fail'}`;

                        let stepsHtml = '';
                        test.steps.forEach((step, idx) => {
                            const stepResult = idx < stepsPassed ? 'âœ…' : 'âŒ';
                            stepsHtml += `<small>ã‚¹ãƒ†ãƒƒãƒ—${idx + 1} (${step.target}): ${stepResult}</small><br>`;
                        });

                        testDiv.innerHTML = `
                            <strong>${test.name}</strong>: ${testPassed ? 'âœ… PASS' : 'âŒ FAIL'}<br>
                            æˆåŠŸã‚¹ãƒ†ãƒƒãƒ—: ${stepsPassed}/${totalSteps}<br>
                            ${stepsHtml}
                        `;

                        const resultsDiv = document.getElementById('testResults');
                        resultsDiv.appendChild(testDiv);

                        // æ¬¡ã®ãƒ†ã‚¹ãƒˆã¸
                        currentTestIndex++;
                        setTimeout(() => {
                            runNextMultiTest();
                        }, 300);
                        return;
                    }

                    const step = test.steps[stepIndex];
                    console.log(`Step ${stepIndex + 1}: Looking for "${step.target}"`);

                    setTimeout(() => {
                        const currentText = editor.innerText;
                        const targetPosition = currentText.indexOf(step.target);

                        console.log(`Current text length: ${currentText.length}`);
                        console.log(`Target "${step.target}" found at position: ${targetPosition}`);

                        if (targetPosition >= 0) {
                            const endPosition = targetPosition + step.target.length;
                            setSelection(targetPosition, endPosition);

                            setTimeout(() => {
                                applyBold();

                                setTimeout(() => {
                                    const actualResult = editor.innerText;
                                    const stepPassed = actualResult === step.expectedAfterStep;

                                    console.log(`Step ${stepIndex + 1} result: ${stepPassed ? 'PASS' : 'FAIL'}`);
                                    console.log(`Expected length: ${step.expectedAfterStep.length}`);
                                    console.log(`Actual length: ${actualResult.length}`);

                                    if (!stepPassed) {
                                        console.log(`Expected: "${step.expectedAfterStep}"`);
                                        console.log(`Actual: "${actualResult}"`);
                                    }

                                    if (stepPassed) stepsPassed++;

                                    stepIndex++;
                                    setTimeout(() => {
                                        runNextStep();
                                    }, 200);

                                }, 150);
                            }, 150);
                        } else {
                            console.error(`Target "${step.target}" not found in current text`);
                            stepIndex++;
                            setTimeout(() => {
                                runNextStep();
                            }, 200);
                        }
                    }, 200);
                }

                setTimeout(() => {
                    runNextStep();
                }, 200);
            }

            // ç°¡å˜ãªçŸ­æ–‡ãƒ†ã‚¹ãƒˆï¼ˆæ—¢å­˜ã®ãƒ­ã‚¸ãƒƒã‚¯ï¼‰
            function runSimpleMultiStepTest() {
                console.log(`\n=== Running simple multi-step test ===`);

                editor.innerText = 'ã‚ã„ã†ãˆãŠ';
                editor.focus();

                let stepPassCount = 0;
                let totalSteps = 2;

                setTimeout(() => {
                    console.log(`Multi-step setup complete. Text: "${editor.innerText}"`);

                    // ã‚¹ãƒ†ãƒƒãƒ—1: "ã„ã†"ã‚’Bold
                    setSelection(1, 3);

                    setTimeout(() => {
                        applyBold();

                        setTimeout(() => {
                            const step1Result = editor.innerText;
                            const step1Expected = 'ã‚**ã„ã†**ãˆãŠ';
                            const step1Passed = step1Result === step1Expected;

                            console.log(`Step 1 result: ${step1Passed ? 'PASS' : 'FAIL'}`);
                            console.log(`Step 1 Expected: "${step1Expected}"`);
                            console.log(`Step 1 Actual: "${step1Result}"`);

                            if (step1Passed) stepPassCount++;

                            // ã‚¹ãƒ†ãƒƒãƒ—2: "ãˆ"ã‚’Boldï¼ˆæ–°ã—ã„ä½ç½®ã§ï¼‰
                            setTimeout(() => {
                                // Boldè¿½åŠ å¾Œã®æ–°ã—ã„ä½ç½®ã‚’è¨ˆç®—
                                const currentText = editor.innerText; // "ã‚**ã„ã†**ãˆãŠ"
                                const targetChar = 'ãˆ';
                                const targetPosition = currentText.indexOf(targetChar);

                                console.log(`Step 2: Looking for "${targetChar}" in "${currentText}"`);
                                console.log(`Step 2: Target position: ${targetPosition}`);

                                if (targetPosition >= 0) {
                                    setSelection(targetPosition, targetPosition + 1);

                                    setTimeout(() => {
                                        applyBold();

                                        setTimeout(() => {
                                            const step2Result = editor.innerText;
                                            const step2Expected = 'ã‚**ã„ã†****ãˆ**ãŠ';
                                            const step2Passed = step2Result === step2Expected;

                                            console.log(`Step 2 result: ${step2Passed ? 'PASS' : 'FAIL'}`);
                                            console.log(`Step 2 Expected: "${step2Expected}"`);
                                            console.log(`Step 2 Actual: "${step2Result}"`);

                                            if (step2Passed) stepPassCount++;

                                            // çŸ­æ–‡ãƒ†ã‚¹ãƒˆã®çµæœè¡¨ç¤º
                                            const multiTestDiv = document.createElement('div');
                                            const allStepsPassed = stepPassCount === totalSteps;
                                            multiTestDiv.className = `test-case ${allStepsPassed ? 'pass' : 'fail'}`;

                                            multiTestDiv.innerHTML = `
                                                <strong>çŸ­æ–‡ãƒ»è¤‡æ•°å›Boldé©ç”¨ãƒ†ã‚¹ãƒˆ</strong>: ${allStepsPassed ? 'âœ… PASS' : 'âŒ FAIL'}<br>
                                                <small>ã‚¹ãƒ†ãƒƒãƒ—1: ${step1Passed ? 'âœ…' : 'âŒ'} æœŸå¾…å€¤: "${step1Expected}" å®Ÿéš›å€¤: "${step1Result}"</small><br>
                                                <small>ã‚¹ãƒ†ãƒƒãƒ—2: ${step2Passed ? 'âœ…' : 'âŒ'} æœŸå¾…å€¤: "${step2Expected}" å®Ÿéš›å€¤: "${step2Result}"</small>
                                            `;

                                            const resultsDiv = document.getElementById('testResults');
                                            resultsDiv.appendChild(multiTestDiv);

                                            // å…¨ãƒ†ã‚¹ãƒˆå®Œäº†æ™‚ã®æœ€çµ‚ã‚µãƒãƒªãƒ¼
                                            if (allStepsPassed) allTestsPassed++;
                                            totalMultiTests++; // çŸ­æ–‡ãƒ†ã‚¹ãƒˆã‚’ç·æ•°ã«è¿½åŠ 

                                            const finalSummaryDiv = document.createElement('div');
                                            finalSummaryDiv.style.marginTop = '20px';
                                            finalSummaryDiv.style.padding = '15px';
                                            finalSummaryDiv.style.backgroundColor = '#e3f2fd';
                                            finalSummaryDiv.style.border = '2px solid #2196f3';
                                            finalSummaryDiv.style.borderRadius = '8px';
                                            finalSummaryDiv.style.fontWeight = 'bold';
                                            finalSummaryDiv.style.color = allTestsPassed === totalMultiTests ? '#1565c0' : '#d32f2f';
                                            finalSummaryDiv.innerHTML = `
                                                <h4 style="margin: 0 0 10px 0;">ğŸ¯ é•·æ–‡ãƒ»è¤‡æ•°å›Boldé©ç”¨ãƒ†ã‚¹ãƒˆ æœ€çµ‚çµæœ</h4>
                                                <p style="margin: 5px 0; font-size: 16px;">æˆåŠŸ: ${allTestsPassed}/${totalMultiTests} ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹</p>
                                                <p style="margin: 5px 0; font-size: 14px;">
                                                    ${allTestsPassed === totalMultiTests ?
                                                        'ğŸ‰ å…¨ã¦ã®ãƒ†ã‚¹ãƒˆãŒæˆåŠŸã—ã¾ã—ãŸï¼' :
                                                        'âš ï¸ ä¸€éƒ¨ã®ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã—ã¾ã—ãŸã€‚è©³ç´°ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚'}
                                                </p>
                                            `;
                                            resultsDiv.appendChild(finalSummaryDiv);

                                            // ã‚¨ãƒ‡ã‚£ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆ
                                            setTimeout(() => {
                                                editor.innerText = 'ã“ã‚Œã¯æœ€åˆã®è¡Œã§ã™ã€‚\nã“ã‚Œã¯äºŒè¡Œç›®ã§ã€ã“ã“ã«é•·ã„ãƒ†ã‚­ã‚¹ãƒˆãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚\nã“ã‚Œã¯ä¸‰è¡Œç›®ã§ã™ã€‚\næœ€å¾Œã®è¡Œã§ã™ã€‚';
                                            }, 500);

                                        }, 100);
                                    }, 100);
                                } else {
                                    console.error('Step 2: Could not find target character');
                                    // ã‚¨ãƒ©ãƒ¼æ™‚ã‚‚çµæœã‚’è¡¨ç¤º
                                    const resultsDiv = document.getElementById('testResults');
                                    const errorDiv = document.createElement('div');
                                    errorDiv.className = 'test-case fail';
                                    errorDiv.innerHTML = `
                                        <strong>çŸ­æ–‡ãƒ»è¤‡æ•°å›Boldé©ç”¨ãƒ†ã‚¹ãƒˆ</strong>: âŒ FAIL<br>
                                        <small>ã‚¨ãƒ©ãƒ¼: ã‚¹ãƒ†ãƒƒãƒ—2ã§å¯¾è±¡æ–‡å­—ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ</small>
                                    `;
                                    resultsDiv.appendChild(errorDiv);
                                }
                            }, 200);

                        }, 100);
                    }, 100);
                }, 100);
            }

            // ãƒ†ã‚¹ãƒˆé–‹å§‹
            runNextMultiTest();
        }
        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        editor.addEventListener('mouseup', showSelectionInfo);
        editor.addEventListener('keyup', showSelectionInfo);

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            showSelectionInfo();
        });
    </script>
</body>
</html>
